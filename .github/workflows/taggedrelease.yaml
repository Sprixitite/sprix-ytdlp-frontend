name: Create Release

on:
    push:
        tags:
            - "v*"

jobs:
    build-windows:
        runs-on: windows-latest
        steps:
            - uses: actions/checkout@v3
            - uses: subosito/flutter-action@v2
              with:
                channel: "stable"
            - run: flutter config --enable-windows-desktop
            - run: flutter build windows --release
    build-linux:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v3
            - uses: subosito/flutter-action@v2
              with:
                channel: "stable"
            - run: |
                sudo apt-get update -y
                sudo apt-get install -y ninja-build libgtk-3-dev
            - run: flutter config --enable-linux-desktop
            - run: flutter build linux --release
    do-release:
        runs-on: ubuntu-latest
        needs: [build-linux, build-windows]
        steps:
            - name: Compress Build Outputs & Upload Release
              id: compress_outputs
              run: |
                sudo apt install zip tar
                zip ./windows.zip ./build/windows/runner/Release/ytdl.exe
                tar -zcf ./linux.tar.gz ./build/linux/x64/release/bundle/ytdl

            - uses: "marvinpinto/action-automatic-releases@latest"
              with:
                repo_token: "${{ secrets.GITHUB_TOKEN }}"
                draft: false
                prerelease: false
                automatic_release_tag: "latest"
                title: "Latest Release Build"
                files: |
                    windows.zip
                    linux.tar.gz